<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LTIMindtree Assessment Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .assessment-tracks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .track-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: transform 0.3s, border-color 0.3s;
            cursor: pointer;
        }

        .track-card:hover {
            transform: translateY(-5px);
            border-color: #3498db;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .track-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .track-card p {
            color: #7f8c8d;
            margin-bottom: 15px;
        }

        .question-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: #3498db;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .question-timer {
            background: #e74c3c;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .options {
            list-style: none;
        }

        .options li {
            margin-bottom: 15px;
        }

        .options input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .options label {
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .options label:hover {
            background-color: #e8f4f8;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s ease;
        }

        .result-container {
            text-align: center;
            padding: 40px;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 20px auto;
        }

        .admin-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }

        .question-builder {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            background: white;
        }

        .question-builder h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .option-input {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .option-input input[type="text"] {
            flex: 1;
            margin-right: 10px;
        }

        .option-input input[type="radio"] {
            margin-left: 10px;
        }

        .quiz-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quiz-info h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .quiz-info p {
            color: #7f8c8d;
            margin: 2px 0;
        }

        .quiz-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .results-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-error {
            background: #fdeaea;
            color: #e74c3c;
            border: 1px solid #f5b7b1;
        }

        .alert-success {
            background: #eafaf1;
            color: #27ae60;
            border: 1px solid #a9dfbf;
        }

        .event-info {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .assessment-tracks {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>LTIMindtree Assessment Platform</h1>
            <p>Internal Assessment Event - August 13th, 2025</p>
        </div>

        <div class="content">
            <!-- Login Screen -->
            <div id="loginScreen" class="screen active">
                <div class="event-info">
                    <h3>ðŸ“… Assessment Event Details</h3>
                    <p><strong>Date:</strong> August 13th, 2025 | <strong>Time:</strong> 5:00 PM - 10:00 PM IST</p>
                    <p>Multiple assessment tracks available | Non-proctored | LTIMindtree Associates only</p>
                </div>

                <h2>Welcome to Assessment Platform</h2>
                <p>Please enter your details to access the assessments. Only LTIMindtree email addresses are allowed.</p>
                
                <div id="loginAlert"></div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label for="userName">Full Name *</label>
                        <input type="text" id="userName" required placeholder="Enter your full name">
                    </div>
                    
                    <div class="form-group">
                        <label for="userEmail">Email Address *</label>
                        <input type="email" id="userEmail" required placeholder="yourname@ltimindtree.com">
                    </div>
                    
                    <button type="submit" class="btn">Access Assessments</button>
                    <button type="button" class="btn btn-secondary" onclick="showAdminLogin()">Admin Login</button>
                </form>
            </div>

            <!-- Admin Login Screen -->
            <div id="adminLoginScreen" class="screen">
                <h2>Admin Login</h2>
                <p>Please enter your admin credentials to access the administration panel.</p>
                
                <div id="adminLoginAlert"></div>
                
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminUsername">Admin Username *</label>
                        <input type="text" id="adminUsername" required placeholder="Enter admin username">
                    </div>
                    
                    <div class="form-group">
                        <label for="adminPassword">Admin Password *</label>
                        <input type="password" id="adminPassword" required placeholder="Enter admin password">
                    </div>
                    
                    <button type="submit" class="btn">Login to Admin Panel</button>
                    <button type="button" class="btn btn-secondary" onclick="backToLogin()">Back to User Login</button>
                </form>
            </div>

            <!-- Track Selection Screen -->
            <div id="trackSelectionScreen" class="screen">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h2>Select Assessment Track</h2>
                        <p>Welcome, <span id="welcomeUser"></span>!</p>
                    </div>
                    <button class="btn btn-secondary" onclick="logout()">Logout</button>
                </div>
                
                <div class="assessment-tracks" id="assessmentTracks">
                    <!-- Tracks will be populated here -->
                </div>
            </div>

            <!-- Assessment Screen -->
            <div id="assessmentScreen" class="screen">
                <div class="question-container">
                    <div class="question-header">
                        <div class="question-number" id="questionNumber">Question 1 of 10</div>
                        <div class="question-timer" id="questionTimer">Time: 00:00</div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    
                    <div class="question-text" id="questionText"></div>
                    
                    <ul class="options" id="questionOptions"></ul>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()">Previous</button>
                        <button class="btn" id="nextBtn" onclick="nextQuestion()">Next</button>
                        <button class="btn btn-success" id="submitBtn" onclick="submitAssessment()" style="display: none;">Submit Assessment</button>
                    </div>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="screen">
                <div class="result-container">
                    <h2>Assessment Completed!</h2>
                    <div class="score-circle" id="scoreDisplay">0/0</div>
                    <h3 id="resultMessage"></h3>
                    <p id="resultDetails"></p>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn" onclick="backToTracks()">Take Another Assessment</button>
                        <button class="btn btn-secondary" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminScreen" class="screen">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Admin Dashboard</h2>
                    <div>
                        <button class="btn" onclick="showQuizCreation()">Create New Quiz</button>
                        <button class="btn btn-secondary" onclick="adminLogout()">Logout</button>
                    </div>
                </div>
                
                <div class="admin-panel">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalParticipants">0</div>
                            <div class="stat-label">Total Participants</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalAssessments">0</div>
                            <div class="stat-label">Assessments Completed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgScore">0%</div>
                            <div class="stat-label">Average Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalQuizzes">6</div>
                            <div class="stat-label">Total Quizzes</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-success" onclick="exportResults()">Export All Results</button>
                        <button class="btn" onclick="exportRecentResults()">Export Recent (2 Hours)</button>
                        <button class="btn" onclick="showQuizManagement()">Manage Quizzes</button>
                        <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h3>Individual Assessment Links</h3>
                        <p>Share these direct links for each assessment track:</p>
                        <div id="trackLinksContainer" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 10px;">
                            <!-- Track links will be populated here -->
                        </div>
                    </div>
                    
                    <h3>Assessment Results</h3>
                    <table class="results-table" id="resultsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Assessment Track</th>
                                <th>Login Date and Time</th>
                                <th>Completion Time</th>
                                <th>Max Score</th>
                                <th>Achieved Score</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Quiz Creation Screen -->
            <div id="quizCreationScreen" class="screen">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Create New Assessment Quiz</h2>
                    <button class="btn btn-secondary" onclick="backToAdmin()">Back to Dashboard</button>
                </div>
                
                <div class="admin-panel">
                    <div id="quizCreationAlert"></div>
                    
                    <form id="quizCreationForm">
                        <div class="form-group">
                            <label for="quizId">Quiz ID *</label>
                            <input type="text" id="quizId" required placeholder="e.g., 'nodejs' (lowercase, no spaces)">
                        </div>
                        
                        <div class="form-group">
                            <label for="quizName">Quiz Name *</label>
                            <input type="text" id="quizName" required placeholder="e.g., 'Node.js Development'">
                        </div>
                        
                        <div class="form-group">
                            <label for="quizDescription">Quiz Description *</label>
                            <input type="text" id="quizDescription" required placeholder="Brief description of the quiz">
                        </div>
                        
                        <div class="form-group">
                            <label for="numQuestions">Number of Questions *</label>
                            <input type="number" id="numQuestions" required min="1" max="20" value="5" onchange="generateQuestionFields()">
                        </div>
                        
                        <div class="form-group">
                            <label for="pointsPerQuestion">Points per Question *</label>
                            <input type="number" id="pointsPerQuestion" required min="1" max="10" value="1">
                        </div>
                        
                        <div id="questionsContainer"></div>
                        
                        <div style="margin-top: 30px;">
                            <button type="submit" class="btn btn-success">Create Quiz</button>
                            <button type="button" class="btn btn-secondary" onclick="clearQuizForm()">Clear Form</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Quiz Management Screen -->
            <div id="quizManagementScreen" class="screen">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Quiz Management</h2>
                    <button class="btn btn-secondary" onclick="backToAdmin()">Back to Dashboard</button>
                </div>
                
                <div class="admin-panel">
                    <h3>Existing Quizzes</h3>
                    <div id="quizManagementContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample assessment data - replace with your actual question banks
        const assessmentTracks = {
            'javascript': {
                name: 'JavaScript Fundamentals',
                description: 'Test your knowledge of JavaScript basics and ES6+ features',
                pointsPerQuestion: 1,
                questions: [
                    {
                        question: 'What is the correct way to declare a variable in JavaScript?',
                        options: ['var myVar = 5;', 'variable myVar = 5;', 'v myVar = 5;', 'declare myVar = 5;'],
                        correct: 0
                    },
                    {
                        question: 'Which method is used to add an element to the end of an array?',
                        options: ['append()', 'push()', 'add()', 'insert()'],
                        correct: 1
                    },
                    {
                        question: 'What does "=== " operator do in JavaScript?',
                        options: ['Assignment', 'Equality without type checking', 'Strict equality with type checking', 'Not equal'],
                        correct: 2
                    },
                    {
                        question: 'Which of the following is NOT a JavaScript data type?',
                        options: ['Number', 'String', 'Boolean', 'Float'],
                        correct: 3
                    },
                    {
                        question: 'What is the output of: console.log(typeof null)?',
                        options: ['null', 'undefined', 'object', 'boolean'],
                        correct: 2
                    }
                ]
            },
            'python': {
                name: 'Python Programming',
                description: 'Assess your Python programming skills and best practices',
                pointsPerQuestion: 1,
                questions: [
                    {
                        question: 'Which of the following is the correct way to create a list in Python?',
                        options: ['list = []', 'list = ()', 'list = {}', 'list = ""'],
                        correct: 0
                    },
                    {
                        question: 'What is the output of: print(3 ** 2)?',
                        options: ['6', '9', '32', 'Error'],
                        correct: 1
                    },
                    {
                        question: 'Which keyword is used to define a function in Python?',
                        options: ['function', 'def', 'define', 'func'],
                        correct: 1
                    },
                    {
                        question: 'What does the len() function do?',
                        options: ['Returns the length of an object', 'Creates a new list', 'Sorts a list', 'Removes duplicates'],
                        correct: 0
                    },
                    {
                        question: 'Which of the following is used for comments in Python?',
                        options: ['//', '/* */', '#', '<!-- -->'],
                        correct: 2
                    }
                ]
            },
            'react': {
                name: 'React Development',
                description: 'Test your React.js knowledge and component-based development',
                pointsPerQuestion: 1,
                questions: [
                    {
                        question: 'What is JSX in React?',
                        options: ['A JavaScript library', 'A syntax extension for JavaScript', 'A CSS framework', 'A database'],
                        correct: 1
                    },
                    {
                        question: 'Which hook is used to manage state in functional components?',
                        options: ['useEffect', 'useState', 'useContext', 'useReducer'],
                        correct: 1
                    },
                    {
                        question: 'What is the virtual DOM?',
                        options: ['A real DOM element', 'A JavaScript representation of the real DOM', 'A CSS property', 'A React component'],
                        correct: 1
                    },
                    {
                        question: 'How do you pass data from parent to child component?',
                        options: ['Using state', 'Using props', 'Using context', 'Using refs'],
                        correct: 1
                    },
                    {
                        question: 'What is the purpose of useEffect hook?',
                        options: ['To manage state', 'To handle side effects', 'To create components', 'To style components'],
                        correct: 1
                    }
                ]
            },
            'database': {
                name: 'Database Management',
                description: 'Test your knowledge of database concepts and SQL',
                pointsPerQuestion: 1,
                questions: [
                    {
                        question: 'What does SQL stand for?',
                        options: ['Standard Query Language', 'Structured Query Language', 'Simple Query Language', 'System Query Language'],
                        correct: 1
                    },
                    {
                        question: 'Which command is used to retrieve data from a database?',
                        options: ['GET', 'SELECT', 'RETRIEVE', 'FETCH'],
                        correct: 1
                    },
                    {
                        question: 'What is a primary key?',
                        options: ['A duplicate key', 'A unique identifier for a record', 'A foreign key', 'An index'],
                        correct: 1
                    },
                    {
                        question: 'Which of the following is a type of database relationship?',
                        options: ['One-to-One', 'One-to-Many', 'Many-to-Many', 'All of the above'],
                        correct: 3
                    },
                    {
                        question: 'What does CRUD stand for?',
                        options: ['Create, Read, Update, Delete', 'Copy, Read, Update, Delete', 'Create, Retrieve, Update, Delete', 'Create, Read, Undo, Delete'],
                        correct: 0
                    }
                ]
            },
            'cybersecurity': {
                name: 'Cybersecurity Basics',
                description: 'Assess your understanding of cybersecurity principles',
                pointsPerQuestion: 1,
                questions: [
                    {
                        question: 'What is phishing?',
                        options: ['A type of malware', 'A social engineering attack', 'A firewall technique', 'A encryption method'],
                        correct: 1
                    },
                    {
                        question: 'What does HTTPS stand for?',
                        options: ['HyperText Transfer Protocol Secure', 'HyperText Transfer Protocol Standard', 'HyperText Transport Protocol Secure', 'HyperText Transfer Protocol System'],
                        correct: 0
                    },
                    {
                        question: 'What is two-factor authentication?',
                        options: ['Using two passwords', 'Using two security methods', 'Using two computers', 'Using two networks'],
                        correct: 1
                    },
                    {
                        question: 'What is malware?',
                        options: ['Good software', 'Malicious software', 'System software', 'Application software'],
                        correct: 1
                    },
                    {
                        question: 'What is the purpose of a firewall?',
                        options: ['To prevent fires', 'To block unauthorized access', 'To speed up internet', 'To store data'],
                        correct: 1
                    }
                ]
            },
            'cloud': {
                name: 'Cloud Computing',
                description: 'Test your knowledge of cloud technologies and services',
                pointsPerQuestion: 1,
                questions: [
                    {
                        question: 'What are the three main types of cloud computing services?',
                        options: ['IaaS, PaaS, SaaS', 'Public, Private, Hybrid', 'AWS, Azure, GCP', 'Storage, Compute, Network'],
                        correct: 0
                    },
                    {
                        question: 'What does IaaS stand for?',
                        options: ['Internet as a Service', 'Infrastructure as a Service', 'Information as a Service', 'Integration as a Service'],
                        correct: 1
                    },
                    {
                        question: 'Which is a benefit of cloud computing?',
                        options: ['Scalability', 'Cost efficiency', 'Accessibility', 'All of the above'],
                        correct: 3
                    },
                    {
                        question: 'What is a virtual machine?',
                        options: ['A physical computer', 'A software-based computer', 'A network device', 'A storage device'],
                        correct: 1
                    },
                    {
                        question: 'What is containerization?',
                        options: ['Storing data in containers', 'Packaging applications with dependencies', 'Moving data between servers', 'Encrypting data'],
                        correct: 1
                    }
                ]
            }
        };

        // Global variables
        let currentUser = null;
        let currentTrack = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let startTime = null;
        let loginTime = null;
        let timerInterval = null;
        let isAdmin = false;
        let autoStartTrack = null;

        // Admin credentials
        const adminCredentials = {
            username: 'admin',
            password: 'ltimindtree2024'
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadCustomQuizzes();
            loadResults();
            updateAdminStats();
            generateQuestionFields(); // Initialize question fields
            
            // Check for auto-start track parameter
            const urlParams = new URLSearchParams(window.location.search);
            const trackParam = urlParams.get('track');
            if (trackParam && assessmentTracks[trackParam]) {
                autoStartTrack = trackParam;
                showTrackSpecificLogin();
            }
        });

        // Show track-specific login screen
        function showTrackSpecificLogin() {
            const trackInfo = assessmentTracks[autoStartTrack];
            document.querySelector('.event-info').innerHTML = `
                <h3>ðŸŽ¯ Direct Assessment Access</h3>
                <p><strong>Assessment:</strong> ${trackInfo.name}</p>
                <p><strong>Questions:</strong> ${trackInfo.questions.length} | <strong>Total Points:</strong> ${trackInfo.questions.length * (trackInfo.pointsPerQuestion || 1)}</p>
                <p>Please login to start this assessment directly</p>
            `;
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            
            if (!validateLogin(name, email)) {
                return;
            }
            
            // Capture login time
            loginTime = new Date();
            currentUser = { 
                name, 
                email, 
                loginTime: loginTime.toISOString()
            };
            
            // If auto-start track is set, go directly to assessment
            if (autoStartTrack) {
                startAssessment(autoStartTrack);
            } else {
                showTrackSelection();
            }
        });

        // Admin login functionality
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            
            if (validateAdminLogin(username, password)) {
                isAdmin = true;
                showAdminPanel();
            }
        });

        // Quiz creation form
        document.getElementById('quizCreationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            createNewQuiz();
        });

        function validateAdminLogin(username, password) {
            const alertDiv = document.getElementById('adminLoginAlert');
            
            if (username === adminCredentials.username && password === adminCredentials.password) {
                return true;
            } else {
                showAdminAlert('Invalid username or password. Please try again.', 'error');
                return false;
            }
        }

        function showAdminAlert(message, type) {
            const alertDiv = document.getElementById('adminLoginAlert');
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 5000);
        }

        function showQuizAlert(message, type) {
            const alertDiv = document.getElementById('quizCreationAlert');
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 5000);
        }

        function validateLogin(name, email) {
            const alertDiv = document.getElementById('loginAlert');
            
            if (!name || !email) {
                showAlert('Please fill in all required fields.', 'error');
                return false;
            }
            
            if (!email.endsWith('@ltimindtree.com')) {
                showAlert('Access restricted to LTIMindtree email addresses only.', 'error');
                return false;
            }
            
            return true;
        }

        function showAlert(message, type) {
            const alertDiv = document.getElementById('loginAlert');
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 5000);
        }

        // Screen navigation
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showAdminLogin() {
            showScreen('adminLoginScreen');
        }

        function showQuizCreation() {
            generateQuestionFields();
            showScreen('quizCreationScreen');
        }

        function showQuizManagement() {
            populateQuizManagement();
            showScreen('quizManagementScreen');
        }

        function backToAdmin() {
            updateAdminStats();
            populateResultsTable();
            showScreen('adminScreen');
        }

        function adminLogout() {
            isAdmin = false;
            document.getElementById('adminLoginForm').reset();
            showScreen('loginScreen');
        }

        // Quiz Creation Functions
        function generateQuestionFields() {
            const numQuestions = parseInt(document.getElementById('numQuestions').value) || 5;
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';

            for (let i = 0; i < numQuestions; i++) {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-builder';
                questionDiv.innerHTML = `
                    <h4>Question ${i + 1}</h4>
                    <div class="form-group">
                        <label>Question Text *</label>
                        <input type="text" class="question-text" required placeholder="Enter the question">
                    </div>
                    <div class="form-group">
                        <label>Options</label>
                        <div class="option-input">
                            <input type="text" class="option" required placeholder="Option A">
                            <label><input type="radio" name="correct${i}" value="0"> Correct</label>
                        </div>
                        <div class="option-input">
                            <input type="text" class="option" required placeholder="Option B">
                            <label><input type="radio" name="correct${i}" value="1"> Correct</label>
                        </div>
                        <div class="option-input">
                            <input type="text" class="option" required placeholder="Option C">
                            <label><input type="radio" name="correct${i}" value="2"> Correct</label>
                        </div>
                        <div class="option-input">
                            <input type="text" class="option" required placeholder="Option D">
                            <label><input type="radio" name="correct${i}" value="3"> Correct</label>
                        </div>
                    </div>
                `;
                container.appendChild(questionDiv);
            }
        }

        function createNewQuiz() {
            const quizId = document.getElementById('quizId').value.trim().toLowerCase();
            const quizName = document.getElementById('quizName').value.trim();
            const quizDescription = document.getElementById('quizDescription').value.trim();
            const numQuestions = parseInt(document.getElementById('numQuestions').value);
            const pointsPerQuestion = parseInt(document.getElementById('pointsPerQuestion').value);

            // Validate basic fields
            if (!quizId || !quizName || !quizDescription) {
                showQuizAlert('Please fill in all required fields.', 'error');
                return;
            }

            if (assessmentTracks[quizId]) {
                showQuizAlert('Quiz ID already exists. Please choose a different ID.', 'error');
                return;
            }

            // Collect questions
            const questions = [];
            const questionBuilders = document.querySelectorAll('.question-builder');

            for (let i = 0; i < questionBuilders.length; i++) {
                const builder = questionBuilders[i];
                const questionText = builder.querySelector('.question-text').value.trim();
                const options = Array.from(builder.querySelectorAll('.option')).map(input => input.value.trim());
                const correctAnswer = builder.querySelector(`input[name="correct${i}"]:checked`);

                if (!questionText || options.some(opt => !opt) || !correctAnswer) {
                    showQuizAlert(`Please complete all fields for Question ${i + 1}.`, 'error');
                    return;
                }

                questions.push({
                    question: questionText,
                    options: options,
                    correct: parseInt(correctAnswer.value),
                    points: pointsPerQuestion
                });
            }

            // Create the new quiz
            assessmentTracks[quizId] = {
                name: quizName,
                description: quizDescription,
                questions: questions,
                pointsPerQuestion: pointsPerQuestion,
                isCustom: true
            };

            // Save to localStorage
            saveCustomQuizzes();
            
            showQuizAlert('Quiz created successfully!', 'success');
            clearQuizForm();
            updateAdminStats();
            
            // Update track links if we're viewing the admin panel
            if (document.getElementById('adminScreen').classList.contains('active')) {
                populateTrackLinks();
            }
        }

        function clearQuizForm() {
            document.getElementById('quizCreationForm').reset();
            generateQuestionFields();
        }

        function saveCustomQuizzes() {
            const customQuizzes = {};
            Object.keys(assessmentTracks).forEach(key => {
                if (assessmentTracks[key].isCustom) {
                    customQuizzes[key] = assessmentTracks[key];
                }
            });
            localStorage.setItem('customQuizzes', JSON.stringify(customQuizzes));
        }

        function loadCustomQuizzes() {
            const customQuizzes = JSON.parse(localStorage.getItem('customQuizzes') || '{}');
            Object.assign(assessmentTracks, customQuizzes);
        }

        function populateQuizManagement() {
            const container = document.getElementById('quizManagementContainer');
            const baseUrl = window.location.origin + window.location.pathname;
            container.innerHTML = '';

            Object.keys(assessmentTracks).forEach(quizId => {
                const quiz = assessmentTracks[quizId];
                const quizCard = document.createElement('div');
                quizCard.className = 'quiz-card';
                
                const trackUrl = `${baseUrl}?track=${quizId}`;
                
                quizCard.innerHTML = `
                    <div class="quiz-info">
                        <h4>${quiz.name}</h4>
                        <p><strong>ID:</strong> ${quizId}</p>
                        <p><strong>Questions:</strong> ${quiz.questions.length}</p>
                        <p><strong>Points per Question:</strong> ${quiz.pointsPerQuestion || 1}</p>
                        <p><strong>Type:</strong> ${quiz.isCustom ? 'Custom' : 'Default'}</p>
                        <p><strong>Direct Link:</strong> 
                            <input type="text" value="${trackUrl}" readonly 
                                   style="width: 300px; padding: 2px; font-size: 11px; margin-left: 5px;">
                            <button class="btn btn-small" onclick="copyToClipboard('${trackUrl}')" style="margin-left: 5px; padding: 2px 8px;">Copy</button>
                        </p>
                    </div>
                    <div class="quiz-actions">
                        <button class="btn btn-small" onclick="viewQuizDetails('${quizId}')">View Details</button>
                        ${quiz.isCustom ? `<button class="btn btn-danger btn-small" onclick="deleteQuiz('${quizId}')">Delete</button>` : ''}
                    </div>
                `;
                
                container.appendChild(quizCard);
            });
        }

        function viewQuizDetails(quizId) {
            const quiz = assessmentTracks[quizId];
            let details = `Quiz: ${quiz.name}\n`;
            details += `Direct Link: ${window.location.origin + window.location.pathname}?track=${quizId}\n\n`;
            
            quiz.questions.forEach((q, index) => {
                details += `Question ${index + 1}: ${q.question}\n`;
                q.options.forEach((option, optIndex) => {
                    details += `  ${String.fromCharCode(65 + optIndex)}. ${option}${optIndex === q.correct ? ' (Correct)' : ''}\n`;
                });
                details += '\n';
            });
            
            alert(details);
        }

        function deleteQuiz(quizId) {
            if (confirm(`Are you sure you want to delete the quiz "${assessmentTracks[quizId].name}"?`)) {
                delete assessmentTracks[quizId];
                saveCustomQuizzes();
                populateQuizManagement();
                updateAdminStats();
                // Also update track links in main admin panel
                populateTrackLinks();
                alert('Quiz deleted successfully.');
            }
        }

        function showTrackSelection() {
            document.getElementById('welcomeUser').textContent = currentUser.name;
            populateAssessmentTracks();
            showScreen('trackSelectionScreen');
        }

        function populateAssessmentTracks() {
            const container = document.getElementById('assessmentTracks');
            container.innerHTML = '';
            
            Object.keys(assessmentTracks).forEach(trackId => {
                const track = assessmentTracks[trackId];
                const trackCard = document.createElement('div');
                trackCard.className = 'track-card';
                trackCard.onclick = () => startAssessment(trackId);
                
                trackCard.innerHTML = `
                    <h3>${track.name}</h3>
                    <p>${track.description}</p>
                    <p><strong>${track.questions.length} Questions</strong></p>
                    <div class="btn" style="margin-top: 10px;">Start Assessment</div>
                `;
                
                container.appendChild(trackCard);
            });
        }

        // Assessment functionality
        function startAssessment(trackId) {
            currentTrack = trackId;
            currentQuestionIndex = 0;
            userAnswers = [];
            startTime = new Date();
            
            showScreen('assessmentScreen');
            startTimer();
            displayQuestion();
        }

        function displayQuestion() {
            const track = assessmentTracks[currentTrack];
            const question = track.questions[currentQuestionIndex];
            
            document.getElementById('questionNumber').textContent = 
                `Question ${currentQuestionIndex + 1} of ${track.questions.length}`;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('questionOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <label>
                        <input type="radio" name="answer" value="${index}" 
                               ${userAnswers[currentQuestionIndex] === index ? 'checked' : ''}>
                        ${option}
                    </label>
                `;
                optionsContainer.appendChild(li);
            });
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / track.questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Update navigation buttons
            document.getElementById('prevBtn').style.display = currentQuestionIndex === 0 ? 'none' : 'inline-block';
            document.getElementById('nextBtn').style.display = currentQuestionIndex === track.questions.length - 1 ? 'none' : 'inline-block';
            document.getElementById('submitBtn').style.display = currentQuestionIndex === track.questions.length - 1 ? 'inline-block' : 'none';
        }

        function saveCurrentAnswer() {
            const selectedOption = document.querySelector('input[name="answer"]:checked');
            if (selectedOption) {
                userAnswers[currentQuestionIndex] = parseInt(selectedOption.value);
            }
        }

        function nextQuestion() {
            saveCurrentAnswer();
            if (currentQuestionIndex < assessmentTracks[currentTrack].questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        function previousQuestion() {
            saveCurrentAnswer();
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        function startTimer() {
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            if (!startTime) return;
            
            const now = new Date();
            const elapsed = Math.floor((now - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            document.getElementById('questionTimer').textContent = 
                `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function submitAssessment() {
            saveCurrentAnswer();
            clearInterval(timerInterval);
            
            const track = assessmentTracks[currentTrack];
            let score = 0;
            let totalPoints = 0;
            
            userAnswers.forEach((answer, index) => {
                const question = track.questions[index];
                const questionPoints = question.points || track.pointsPerQuestion || 1;
                totalPoints += questionPoints;
                
                if (answer === question.correct) {
                    score += questionPoints;
                }
            });
            
            const endTime = new Date();
            const duration = Math.floor((endTime - startTime) / 1000);
            
            // Save result with all required fields
            saveResult({
                name: currentUser.name,
                email: currentUser.email,
                assessmentTrack: track.name,
                loginDateTime: currentUser.loginTime,
                completionTime: endTime.toISOString(),
                maxScore: totalPoints,
                achievedScore: score,
                totalQuestions: track.questions.length,
                duration: duration,
                answers: userAnswers,
                trackId: currentTrack
            });
            
            showResults(score, totalPoints, track.questions.length);
        }

        function showResults(score, totalPoints, totalQuestions) {
            const percentage = Math.round((score / totalPoints) * 100);
            
            document.getElementById('scoreDisplay').textContent = `${score}/${totalPoints}`;
            document.getElementById('resultMessage').textContent = 
                percentage >= 70 ? 'Excellent Performance!' : 
                percentage >= 50 ? 'Good Job!' : 'Keep Learning!';
            document.getElementById('resultDetails').textContent = 
                `You scored ${percentage}% (${score}/${totalPoints} points) in ${assessmentTracks[currentTrack].name}`;
            
            showScreen('resultsScreen');
        }

        // Data persistence
        function saveResult(result) {
            let results = JSON.parse(localStorage.getItem('assessmentResults') || '[]');
            results.push(result);
            localStorage.setItem('assessmentResults', JSON.stringify(results));
        }

        function loadResults() {
            return JSON.parse(localStorage.getItem('assessmentResults') || '[]');
        }

        // Admin functionality
        function showAdminPanel() {
            updateAdminStats();
            populateResultsTable();
            populateTrackLinks();
            showScreen('adminScreen');
        }

        function populateTrackLinks() {
            const container = document.getElementById('trackLinksContainer');
            const baseUrl = window.location.origin + window.location.pathname;
            container.innerHTML = '';

            Object.keys(assessmentTracks).forEach(trackId => {
                const track = assessmentTracks[trackId];
                const trackUrl = `${baseUrl}?track=${trackId}`;
                
                const linkDiv = document.createElement('div');
                linkDiv.style.marginBottom = '15px';
                linkDiv.style.padding = '10px';
                linkDiv.style.backgroundColor = 'white';
                linkDiv.style.borderRadius = '5px';
                linkDiv.style.border = '1px solid #e0e0e0';
                
                linkDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${track.name}</strong><br>
                            <small style="color: #666;">ID: ${trackId} | Questions: ${track.questions.length}</small>
                        </div>
                        <div>
                            <input type="text" value="${trackUrl}" readonly 
                                   style="width: 400px; padding: 5px; margin-right: 10px; font-size: 12px;">
                            <button class="btn btn-small" onclick="copyToClipboard('${trackUrl}')">Copy Link</button>
                        </div>
                    </div>
                `;
                container.appendChild(linkDiv);
            });
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Link copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Link copied to clipboard!');
            });
        }

        function updateAdminStats() {
            const results = loadResults();
            const participants = new Set(results.map(r => r.email)).size;
            const totalAssessments = results.length;
            const totalQuizzes = Object.keys(assessmentTracks).length;
            const avgScore = results.length > 0 ? 
                Math.round(results.reduce((sum, r) => {
                    const maxScore = r.maxScore || r.totalPoints || r.totalQuestions;
                    const achievedScore = r.achievedScore || r.score;
                    const percentage = (achievedScore / maxScore) * 100;
                    return sum + percentage;
                }, 0) / results.length) : 0;
            
            document.getElementById('totalParticipants').textContent = participants;
            document.getElementById('totalAssessments').textContent = totalAssessments;
            document.getElementById('totalQuizzes').textContent = totalQuizzes;
            document.getElementById('avgScore').textContent = avgScore + '%';
        }

        function populateResultsTable() {
            const results = loadResults();
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';
            
            results.forEach(result => {
                const row = document.createElement('tr');
                
                // Handle both old and new result formats
                const name = result.name;
                const email = result.email;
                const assessmentTrack = result.assessmentTrack || result.track;
                const loginDateTime = result.loginDateTime || result.timestamp || 'N/A';
                const completionTime = result.completionTime || result.timestamp;
                const maxScore = result.maxScore || result.totalPoints || result.totalQuestions;
                const achievedScore = result.achievedScore || result.score;
                
                const loginDate = loginDateTime !== 'N/A' ? new Date(loginDateTime) : null;
                const completionDate = new Date(completionTime);
                
                const percentage = Math.round((achievedScore / maxScore) * 100);
                
                row.innerHTML = `
                    <td>${name}</td>
                    <td>${email}</td>
                    <td>${assessmentTrack}</td>
                    <td>${loginDate ? loginDate.toLocaleDateString() + ' ' + loginDate.toLocaleTimeString() : 'N/A'}</td>
                    <td>${completionDate.toLocaleDateString()} ${completionDate.toLocaleTimeString()}</td>
                    <td>${maxScore}</td>
                    <td>${achievedScore} (${percentage}%)</td>
                `;
                tbody.appendChild(row);
            });
        }

        function exportResults() {
            const results = loadResults();
            const csv = [
                ['Name', 'Email', 'Assessment Track', 'Login Date and Time', 'Completion Time', 'Max Score', 'Achieved Score'].join(','),
                ...results.map(r => {
                    // Handle both old and new result formats
                    const name = r.name;
                    const email = r.email;
                    const assessmentTrack = r.assessmentTrack || r.track;
                    const loginDateTime = r.loginDateTime || r.timestamp || 'N/A';
                    const completionTime = r.completionTime || r.timestamp;
                    const maxScore = r.maxScore || r.totalPoints || r.totalQuestions;
                    const achievedScore = r.achievedScore || r.score;
                    
                    return [
                        `"${name}"`,
                        `"${email}"`,
                        `"${assessmentTrack}"`,
                        `"${loginDateTime !== 'N/A' ? new Date(loginDateTime).toLocaleString() : 'N/A'}"`,
                        `"${new Date(completionTime).toLocaleString()}"`,
                        maxScore,
                        achievedScore
                    ].join(',');
                })
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ltimindtree_assessment_results_${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            alert('Assessment results exported successfully! File format matches your requirements.');
        }

        function exportRecentResults() {
            const results = loadResults();
            const twoHoursAgo = new Date(Date.now() - (2 * 60 * 60 * 1000));
            
            const recentResults = results.filter(r => {
                const completionTime = new Date(r.completionTime || r.timestamp);
                return completionTime >= twoHoursAgo;
            });
            
            if (recentResults.length === 0) {
                alert('No assessments completed in the last 2 hours.');
                return;
            }
            
            const csv = [
                ['Name', 'Email', 'Assessment Track', 'Login Date and Time', 'Completion Time', 'Max Score', 'Achieved Score'].join(','),
                ...recentResults.map(r => {
                    const name = r.name;
                    const email = r.email;
                    const assessmentTrack = r.assessmentTrack || r.track;
                    const loginDateTime = r.loginDateTime || r.timestamp || 'N/A';
                    const completionTime = r.completionTime || r.timestamp;
                    const maxScore = r.maxScore || r.totalPoints || r.totalQuestions;
                    const achievedScore = r.achievedScore || r.score;
                    
                    return [
                        `"${name}"`,
                        `"${email}"`,
                        `"${assessmentTrack}"`,
                        `"${loginDateTime !== 'N/A' ? new Date(loginDateTime).toLocaleString() : 'N/A'}"`,
                        `"${new Date(completionTime).toLocaleString()}"`,
                        maxScore,
                        achievedScore
                    ].join(',');
                })
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ltimindtree_recent_results_${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            alert(`Recent results exported! Found ${recentResults.length} assessments completed in the last 2 hours.`);
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all assessment data? This action cannot be undone.')) {
                localStorage.removeItem('assessmentResults');
                updateAdminStats();
                populateResultsTable();
                alert('All data has been cleared successfully.');
            }
        }

        // Navigation functions
        function backToTracks() {
            showScreen('trackSelectionScreen');
        }

        function backToLogin() {
            showScreen('loginScreen');
        }

        function logout() {
            currentUser = null;
            currentTrack = null;
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            document.getElementById('loginForm').reset();
            showScreen('loginScreen');
        }
    </script>
</body>
</html>